{"name": "festivity", "type": "PixelsWorld Preset", "version": 2, "official": false, "presets": [{"name": "ZenlessLUT", "language": "GLSL", "code": "vec3 ApplyZZZLut(sampler2D tex, vec3 uvw) {\n    vec3 upperBound = vec3(1.0f), lowerBound = vec3(1.0f);\n\n    upperBound.xyz = clamp(log2(uvw.zxy * 5.55556f + 0.047996f) * 0.0735f + 0.386036f, vec3(0.0f), vec3(1.0f));\n\n    float foo = upperBound.x * 31.0f;\n\n    upperBound.xyz *= 31.0f;\n\n    float bar = floor(upperBound.x);\n\n    upperBound.x = upperBound.y * 0.00098f + (0.00098f * 0.5f);\n    upperBound.y = upperBound.z * 0.03125f + (0.03125f * 0.5f);\n    upperBound.z = 0.0f;\n\n    foo -= bar;\n\n    upperBound.zy = upperBound.yx;\n    upperBound.x = bar * 0.03125f + upperBound.x;\n    upperBound.y = 0.0f;\n\n    lowerBound = upperBound;\n    lowerBound.y = lowerBound.z;\n    lowerBound.z = 0.0f;\n\n    upperBound.y = upperBound.z;\n    upperBound.z = 0.0f;\n    upperBound.x += 0.03125f;\n\n    // invert texcoord y-axis origins for GLSL\n    upperBound.y = 1.0f - upperBound.y;\n    lowerBound.y = 1.0f - lowerBound.y;\n\n    vec3 a = texture(tex, upperBound.xy).xyz, b = texture(tex, lowerBound.xy).xyz;\n\n    return mix(b, a, foo);\n}\n\nvoid main() {\n    vec4 input = texture(inLayer, uv);\n\n    // preserve alpha\n    outColor.w = input.w;\n    outColor.xyz = mix(input.xyz, ApplyZZZLut(layer[0], input.xyz), slider[0]);\n}", "param_settings": "{\"slider\": [{\"name\": \"Strength\", \"value\": [1]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}], \"angle\": [{\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}], \"point\": [{\"name\": \"\", \"value\": [0, 0]}, {\"name\": \"\", \"value\": [0, 0]}, {\"name\": \"\", \"value\": [0, 0]}, {\"name\": \"\", \"value\": [0, 0]}, {\"name\": \"\", \"value\": [0, 0]}, {\"name\": \"\", \"value\": [0, 0]}, {\"name\": \"\", \"value\": [0, 0]}, {\"name\": \"\", \"value\": [0, 0]}, {\"name\": \"\", \"value\": [0, 0]}, {\"name\": \"\", \"value\": [0, 0]}], \"point3d\": [{\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}], \"checkbox\": [{\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}], \"color\": [{\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}], \"layer\": [{\"name\": \"LUT\", \"value\": [1]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}]}"}, {"name": "AutoBlend", "language": "Lua", "code": "\nversion3()\n\nglsl([==[\n\nvoid main(\n  //vec4 v0 : SV_POSITION0,\n  //vec2 v1 : TEXCOORD0,\n  //vec2 w1 : TEXCOORD2,\n  //vec2 v2 : TEXCOORD3,\n  //vec2 w2 : TEXCOORD4\n  )\n{\n  vec4 r0,r1,r2,r3,r4,r5,r6,r7,r8,r9,r10;\n\n  vec4 o0;\n  vec2 w1 = uv.xy;\n  vec2 v1 = w1;\n\n  r0.xyz = vec3(lessThan(vec3(0.5,0.5,0.5), vec3(0.0, 0.0, 0.0))); // cb0[30].yxz\n  r0.w = 1 + -v1.y;\n  r1.y = bool(r0.x) ? r0.w : v1.y;\n  r1.x = v1.x;\n  r2.xyzw = texture(inLayer, r1.xy).xyzw;\n  r1.xzw = vec3(1,1,1) + vec3(0.0, 0.0, 0.0); // cb0[28].zyx\n  if (bool(r0.y != 0)) {\n    r3.xyz = vec3(1.0, 1.0, 1.0) * r2.xyz; // cb0[22].xyz\n    r3.xyz = clamp(r3.xyz * r1.xxx, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));\n  } else {\n    r4.xyzw = texture(layer[0], w1.xy, 7).xyzw;\n    r0.y = dot(r2.xyz, vec3(0.298999995,0.587000012,0.114));\n    r5.xyz = r2.xyz + -r0.yyy;\n    r5.xyz = slider[1] * r5.xyz + r0.yyy; // cb0[26].www\n    r6.xyz = vec3(12.9200001,12.9200001,12.9200001) * r2.xyz;\n    r7.xyz = log2(abs(r2.xyz));\n    r7.xyz = vec3(0.416666657,0.416666657,0.416666657) * r7.xyz;\n    r7.xyz = exp2(r7.xyz);\n    r7.xyz = r7.xyz * vec3(1.05499995,1.05499995,1.05499995) + vec3(-0.0549999997,-0.0549999997,-0.0549999997);\n    r8.xyz = vec3(greaterThanEqual(vec3(0.00313080009,0.00313080009,0.00313080009), r2.xyz));\n    r6.x = bool(r8.x) ? r6.x : r7.x;\n\tr6.x = bool(r8.y) ? r6.y : r7.y;\n\tr6.x = bool(r8.z) ? r6.z : r7.z;\n    r0.y = 30 * 0.100000001 + 10; // cb0[29].y = 30\n    r6.xyz = vec3(-0.5,-0.5,-0.5) + r6.xyz;\n    r6.xyz = r6.xyz * -r0.yyy;\n    r6.xyz = vec3(1.44269502,1.44269502,1.44269502) * r6.xyz;\n    r6.xyz = exp2(r6.xyz);\n    r6.xyz = vec3(1,1,1) + r6.xyz;\n    r6.xyz = vec3(1,1,1) / r6.xyz;\n    r0.y = dot(r6.xyz, vec3(0.298999995,0.587000012,0.114));\n    r0.y = clamp(1.5 * r0.y, 0.0, 1.0); // cb0[29].x = 1.5\n    r4.xyz = vec3(-1,-1,-1) + r4.xyz;\n    r4.xyz = vec3(0.3, 0.3, 0.3) * r4.xyz + vec3(1,1,1); // cb0[29].www = 0.3\n    r6.xyz = clamp(r4.xyz * color[1].xyz + r0.yyy, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0)); // cb0[27].xyz\n    r5.xyz = r5.xyz + -r2.xyz;\n    r2.xyz = slider[0] * r5.xyz + r2.xyz; // cb0[29].zzz\n    r5.xyz = r2.xyz * r6.xyz;\n    r4.xyz = r5.xyz * r4.xyz + -r2.xyz;\n    r2.xyz = slider[0] * r4.xyz + r2.xyz; // cb0[29].zzz\n    r4.xyz = r2.xyz * color[0].xyz + -r2.xyz; // cb0[26].xyz\n    r2.xyz = slider[0] * r4.xyz + r2.xyz; // cb0[29].zzz\n    r2.xyz = vec3(1.0, 1.0, 1.0) * r2.xyz; // cb0[22].xyz\n    r4.xyz = vec3(lessThan(r2.xyz, vec3(0.5,0.5,0.5)));\n    r5.xyz = r2.xyz * r1.xxx;\n    r6.xyz = -r2.xyz * vec3(2,2,2) + vec3(1,1,1);\n    r6.xyz = r6.xyz * r5.xyz;\n    r7.xyz = -r2.xyz * r1.xxx + vec3(1,1,1);\n    r6.xyz = -r6.xyz * r7.xyz + r5.xyz;\n    r7.xyz = vec3(lessThan(r5.xyz, vec3(0.25,0.25,0.25)));\n    r8.xyz = r2.xyz * vec3(2,2,2) + vec3(-1,-1,-1);\n    r9.xyz = r8.xyz * r5.xyz;\n    r10.xyz = r5.xyz * vec3(16,16,16) + vec3(-12,-12,-12);\n    r10.xyz = r10.xyz * r5.xyz + vec3(3,3,3);\n    r9.xyz = r9.xyz * r10.xyz + r5.xyz;\n    r10.xyz = sqrt(r5.xyz);\n    r2.xyz = -r2.xyz * r1.xxx + r10.xyz;\n    r2.xyz = r8.xyz * r2.xyz + r5.xyz;\n    r2.x = bool(r7.x) ? r9.x : r2.x;\n\tr2.y = bool(r7.y) ? r9.y : r2.y;\n\tr2.z = bool(r7.z) ? r9.z : r2.z;\n\t//r2.xyz = r7.xyz ? r9.xyz : r2.xyz;\n    //r2.xyz = r4.xyz ? r6.xyz : r2.xyz;\n\tr2.x = bool(r4.x) ? r6.x : r2.x;\n\tr2.y = bool(r4.y) ? r6.y : r2.y;\n\tr2.z = bool(r4.z) ? r6.z : r2.z;\n    r5.xyz = clamp(r5.xyz, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));\n    r1.x = clamp(r1.x, 0.0, 1.0);\n    r4.xyz = r5.xyz + -r2.xyz;\n    r3.xyz = r1.xxx * r4.xyz + r2.xyz;\n  }\n  r2.xyz = vec3(greaterThanEqual(vec3(0.5,0.5,0.5), r3.xyz));\n  r4.xyz = r3.xyz * r3.xyz;\n  r4.xyz = r4.xyz + r4.xyz;\n  r5.xyz = vec3(1,1,1) + -r3.xyz;\n  r5.xyz = r5.xyz * r5.xyz;\n  r5.xyz = -r5.xyz * vec3(2,2,2) + vec3(1,1,1);\n  //r2.xyz = r2.xyz ? r4.xyz : r5.xyz;\n  r2.x = bool(r2.x) ? r4.x : r5.x;\n  r2.y = bool(r2.y) ? r4.y : r5.y;\n  r2.z = bool(r2.z) ? r4.z : r5.z;\n  r4.xyz = vec3(0.333333343,0.333333343,0.333333343) * r3.xyz;\n  r4.xyz = vec3(0.0, 0.0, 0.0) * r4.xyz + r2.xyz; // cb0[28].yyy\n  r4.xyz = r4.xyz + -r3.xyz;\n  r3.xyz = vec3(0.0, 0.0, 0.0) * r4.xyz + r3.xyz; // cb0[28].yyy\n  r2.xyz = vec3(-0.5,-0.5,-0.5) + r2.xyz;\n  r2.xyz = clamp(r2.xyz * r1.zzz + vec3(0.5,0.5,0.5), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));\n  r4.xyz = vec3(0.5,0.5,0.5) * r3.xyz;\n  r4.xyz = r2.xyz * r2.xyz + r4.xyz;\n  r2.xyz = r2.xyz * vec3(0.5,0.5,0.5) + -r4.xyz;\n  r2.xyz = r1.zzz * r2.xyz + r4.xyz;\n  r1.z = clamp(r1.z, 0.0, 1.0);\n  r3.xyz = r3.xyz + -r2.xyz;\n  r2.xyz = r1.zzz * r3.xyz + r2.xyz;\n  r0.y = dot(r2.xyz, vec3(0.298999995,0.587000012,0.114));\n  r2.xyz = r2.xyz + -r0.yyy;\n  r1.xzw = r1.www * r2.xyz + r0.yyy;\n  r0.y = float(v1.x >= 0.0); // cb0[3].x\n  r2.xyz = vec3(1,1,1) + -vec3(0.0, 0.0, 0.0); // cb0[3].ywz\n  r0.w = float(r2.x >= v1.x);\n  //r0.yw = r0.yw ? vec2(1,1) : 0;\n  r0.y = bool(r0.y) ? float(1) : float(0);\n  r0.w = bool(r0.w) ? float(1) : float(0);\n  r0.y = r0.y * r0.w;\n  r3.xy = vec2(greaterThanEqual(r1.yy, vec2(0.0, 0.0))); //cb0[3].zw\n  //r3.xy = r3.xy ? vec2(1,1) : 0;\n  r3.x = bool(r3.x) ? float(1) : float(0);\n  r3.y = bool(r3.y) ? float(1) : float(0);\n  r0.yw = r3.xy * r0.yy;\n  r2.xy = vec2(greaterThanEqual(r2.yz, r1.yy));\n  //r2.xy = r2.xy ? vec2(1,1) : 0;\n  r2.x = bool(r2.x) ? float(1) : float(0);\n  r2.y = bool(r2.y) ? float(1) : float(0);\n  r0.yw = r2.xy * r0.yw;\n  r0.x = bool(r0.x) ? r0.y : r0.w;\n  r0.x = r2.w * r0.x;\n  if (bool(r0.z != 0)) {\n    o0.xyz = vec3(1.0, 1.0, 1.0) * r1.xzw; // cb0[28].www\n    o0.w = 1.0 * r0.x; // cb0[28].w\n    //return;\n  } else {\n    o0.w = 1.0 * r0.x; // cb0[28].w\n    o0.xyz = r1.xzw;\n    //return;\n  }\n  outColor = o0;\n  return;\n}\n\n]==])", "param_settings": "{\"slider\": [{\"name\": \"Blend\", \"value\": [1]}, {\"name\": \"Punchiness\", \"value\": [1]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}], \"angle\": [{\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}], \"point\": [{\"name\": \"\", \"value\": [0, 0]}, {\"name\": \"\", \"value\": [0, 0]}, {\"name\": \"\", \"value\": [0, 0]}, {\"name\": \"\", \"value\": [0, 0]}, {\"name\": \"\", \"value\": [0, 0]}, {\"name\": \"\", \"value\": [0, 0]}, {\"name\": \"\", \"value\": [0, 0]}, {\"name\": \"\", \"value\": [0, 0]}, {\"name\": \"\", \"value\": [0, 0]}, {\"name\": \"\", \"value\": [0, 0]}], \"point3d\": [{\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}], \"checkbox\": [{\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}], \"color\": [{\"name\": \"Tint\", \"value\": [1, 1, 1]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}], \"layer\": [{\"name\": \"Background layer\", \"value\": [1]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}]}"}, {"name": "LYGIA Kuwahara", "language": "GLSL", "code": "#ifndef SAMPLER_FNC\n#if __VERSION__ >= 300\n#define SAMPLER_FNC(TEX, UV) texture(TEX, UV)\n#else\n#define SAMPLER_FNC(TEX, UV) texture2D(TEX, UV)\n#endif\n#endif\n\n#ifndef FNC_SAMPLE\n#define FNC_SAMPLE\nvec4 lygia_sample(sampler2D tex, vec2 uv) { return SAMPLER_FNC(tex, uv); }\n#endif\n\n/*\noriginal_author: [Brad Larson, Ben Cochran, Hugues Lismonde, Keitaroh Kobayashi, Alaric Cole, Matthew Clark, Jacob Gundersen, Chris Williams.]\ndescription: Kuwahara image abstraction, drawn from the work of Kyprianidis, et. al. in their publication \"Anisotropic Kuwahara Filtering on the GPU\" within the GPU Pro collection. This produces an oil-painting-like image, but it is extremely computationally expensive, so it can take seconds to render a frame on an iPad 2. This might be best used for still images.\nuse: kuwahara(<sampler2D> texture, <vec2> st, <vec2> pixel)\noptions:\n    - KUWAHARA_TYPE: defaults to vec3\n    - KUWAHARA_SAMPLER_FNC(TEX, UV): defaults to texture2D(tex, TEX, UV).rgb\n    - KUWAHARA_RADIUS radius\n    - SAMPLER_FNC(TEX, UV): optional depending the target version of GLSL (texture2D(...) or texture(...))\n*/\n\n#ifndef KUWAHARA_TYPE\n#define KUWAHARA_TYPE vec4\n#endif\n\n#ifndef KUWAHARA_SAMPLER_FNC\n#define KUWAHARA_SAMPLER_FNC(TEX, UV) SAMPLER_FNC(TEX, UV)\n#endif\n\n#ifndef FNC_KUWAHARA\n#define FNC_KUWAHARA\n\n#ifdef TARGET_MOBILE\nKUWAHARA_TYPE kuwahara(in sampler2D tex, in vec2 st, in vec2 pixel, in int radius) {\n\n    #ifndef KUWAHARA_RADIUS\n    #define KUWAHARA_RADIUS radius\n    #endif\n\n    float n = float((KUWAHARA_RADIUS + 1) * (KUWAHARA_RADIUS + 1));\n    int i; int j;\n    KUWAHARA_TYPE m0 = KUWAHARA_TYPE(0.0); KUWAHARA_TYPE m1 = KUWAHARA_TYPE(0.0); KUWAHARA_TYPE m2 = KUWAHARA_TYPE(0.0); KUWAHARA_TYPE m3 = KUWAHARA_TYPE(0.0);\n    KUWAHARA_TYPE s0 = KUWAHARA_TYPE(0.0); KUWAHARA_TYPE s1 = KUWAHARA_TYPE(0.0); KUWAHARA_TYPE s2 = KUWAHARA_TYPE(0.0); KUWAHARA_TYPE s3 = KUWAHARA_TYPE(0.0);\n    KUWAHARA_TYPE rta = KUWAHARA_TYPE(0.0);\n    KUWAHARA_TYPE c = KUWAHARA_TYPE(0.0);\n\n    for (j = -KUWAHARA_RADIUS; j <= 0; ++j)  {\n        for (i = -KUWAHARA_RADIUS; i <= 0; ++i)  {\n            c = KUWAHARA_SAMPLER_FNC(tex, st + vec2(i,j) * pixel);\n            m0 += c;\n            s0 += c * c;\n        }\n    }\n\n    for (j = -KUWAHARA_RADIUS; j <= 0; ++j)  {\n        for (i = 0; i <= KUWAHARA_RADIUS; ++i)  {\n            c = KUWAHARA_SAMPLER_FNC(tex, st + vec2(i,j) * pixel);\n            m1 += c;\n            s1 += c * c;\n        }\n    }\n\n    for (j = 0; j <= KUWAHARA_RADIUS; ++j)  {\n        for (i = 0; i <= KUWAHARA_RADIUS; ++i)  {\n            c = KUWAHARA_SAMPLER_FNC(tex, st + vec2(i,j) * pixel);\n            m2 += c;\n            s2 += c * c;\n        }\n    }\n\n    for (j = 0; j <= KUWAHARA_RADIUS; ++j)  {\n        for (i = -KUWAHARA_RADIUS; i <= 0; ++i)  {\n            c = KUWAHARA_SAMPLER_FNC(tex, st + vec2(i,j) * pixel);\n            m3 += c;\n            s3 += c * c;\n        }\n    }\n\n    float min_sigma2 = 1e+2;\n    m0 /= n;\n    s0 = abs(s0 / n - m0 * m0);\n\n    float sigma2 = s0.r + s0.g + s0.b;\n    if (sigma2 < min_sigma2) {\n        min_sigma2 = sigma2;\n        rta = m0;\n    }\n\n    m1 /= n;\n    s1 = abs(s1 / n - m1 * m1);\n\n    sigma2 = s1.r + s1.g + s1.b;\n    if (sigma2 < min_sigma2) {\n        min_sigma2 = sigma2;\n        rta = m1;\n    }\n\n    m2 /= n;\n    s2 = abs(s2 / n - m2 * m2);\n\n    sigma2 = s2.r + s2.g + s2.b;\n    if (sigma2 < min_sigma2) {\n        min_sigma2 = sigma2;\n        rta = m2;\n    }\n\n    m3 /= n;\n    s3 = abs(s3 / n - m3 * m3);\n\n    sigma2 = s3.r + s3.g + s3.b;\n    if (sigma2 < min_sigma2) {\n        min_sigma2 = sigma2;\n        rta = m3;\n    }\n\n    return rta;\n}\n\n#else\n\nKUWAHARA_TYPE kuwahara(in sampler2D tex, in vec2 st, in vec2 pixel, in int radius) {\n\n    #ifndef KUWAHARA_RADIUS\n\n    #if defined(PLATFORM_WEBGL)\n    #define KUWAHARA_RADIUS 20\n    float n = float((radius + 1) * (radius + 1));\n    #else\n    #define KUWAHARA_RADIUS radius\n    float n = float((KUWAHARA_RADIUS + 1) * (KUWAHARA_RADIUS + 1));\n    #endif\n\n    #else\n    float n = float((KUWAHARA_RADIUS + 1) * (KUWAHARA_RADIUS + 1));\n    #endif\n\n    int i; int j;\n    KUWAHARA_TYPE m0 = KUWAHARA_TYPE(0.0); KUWAHARA_TYPE m1 = KUWAHARA_TYPE(0.0); KUWAHARA_TYPE m2 = KUWAHARA_TYPE(0.0); KUWAHARA_TYPE m3 = KUWAHARA_TYPE(0.0);\n    KUWAHARA_TYPE s0 = KUWAHARA_TYPE(0.0); KUWAHARA_TYPE s1 = KUWAHARA_TYPE(0.0); KUWAHARA_TYPE s2 = KUWAHARA_TYPE(0.0); KUWAHARA_TYPE s3 = KUWAHARA_TYPE(0.0);\n    KUWAHARA_TYPE rta = KUWAHARA_TYPE(0.0);\n    KUWAHARA_TYPE c = KUWAHARA_TYPE(0.0);\n    \n    for (j = -KUWAHARA_RADIUS; j <= 0; ++j)  { \n        for (i = -KUWAHARA_RADIUS; i <= 0; ++i)  {\n            c = KUWAHARA_SAMPLER_FNC(tex, st + vec2(i,j) * pixel);\n            m0 += c;\n            s0 += c * c;\n        }\n    }\n    \n    for (j = -KUWAHARA_RADIUS; j <= 0; ++j)  {\n        for (i = 0; i <= KUWAHARA_RADIUS; ++i)  {\n            #if defined(PLATFORM_WEBGL)\n            if (i > radius)\n                break;\n            #endif\n            c = KUWAHARA_SAMPLER_FNC(tex, st + vec2(i,j) * pixel);\n            m1 += c;\n            s1 += c * c;\n        }\n    }\n    \n    for (j = 0; j <= KUWAHARA_RADIUS; ++j)  {\n        #if defined(PLATFORM_WEBGL)\n        if (j > radius)\n            break;\n        #endif\n        for (i = 0; i <= KUWAHARA_RADIUS; ++i)  {\n            #if defined(PLATFORM_WEBGL)\n            if (i > radius)\n                break;\n            #endif\n            c = KUWAHARA_SAMPLER_FNC(tex, st + vec2(i,j) * pixel);\n            m2 += c;\n            s2 += c * c;\n        }\n    }\n    \n    for (j = 0; j <= KUWAHARA_RADIUS; ++j)  {\n        for (i = -KUWAHARA_RADIUS; i <= 0; ++i)  {\n            c = KUWAHARA_SAMPLER_FNC(tex, st + vec2(i,j) * pixel);\n            m3 += c;\n            s3 += c * c;\n        }\n    }\n    \n    \n    float min_sigma2 = 1e+2;\n    m0 /= n;\n    s0 = abs(s0 / n - m0 * m0);\n    \n    float sigma2 = s0.r + s0.g + s0.b;\n    if (sigma2 < min_sigma2) {\n        min_sigma2 = sigma2;\n        rta = m0;\n    }\n    \n    m1 /= n;\n    s1 = abs(s1 / n - m1 * m1);\n    \n    sigma2 = s1.r + s1.g + s1.b;\n    if (sigma2 < min_sigma2) {\n        min_sigma2 = sigma2;\n        rta = m1;\n    }\n    \n    m2 /= n;\n    s2 = abs(s2 / n - m2 * m2);\n    \n    sigma2 = s2.r + s2.g + s2.b;\n    if (sigma2 < min_sigma2) {\n        min_sigma2 = sigma2;\n        rta = m2;\n    }\n    \n    m3 /= n;\n    s3 = abs(s3 / n - m3 * m3);\n    \n    sigma2 = s3.r + s3.g + s3.b;\n    if (sigma2 < min_sigma2) {\n        min_sigma2 = sigma2;\n        rta = m3;\n    }\n\n    return rta;\n}\n\n#endif\n\n#endif\n\nvoid main() {\n    float ratio = float(width / height);\n    vec2 pixelSize = vec2(1.0f * ratio, 1.0f) / resolution;\n\n    outColor = kuwahara(inLayer, uv, (checkbox[0]) ? pixelSize : vec2(1) / resolution, int(max(0, slider[0])));\n}\n", "param_settings": "{\"slider\": [{\"name\": \"Radius\", \"value\": [3]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}], \"angle\": [{\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}], \"point\": [{\"name\": \"\", \"value\": [0, 0]}, {\"name\": \"\", \"value\": [0, 0]}, {\"name\": \"\", \"value\": [0, 0]}, {\"name\": \"\", \"value\": [0, 0]}, {\"name\": \"\", \"value\": [0, 0]}, {\"name\": \"\", \"value\": [0, 0]}, {\"name\": \"\", \"value\": [0, 0]}, {\"name\": \"\", \"value\": [0, 0]}, {\"name\": \"\", \"value\": [0, 0]}, {\"name\": \"\", \"value\": [0, 0]}], \"point3d\": [{\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}], \"checkbox\": [{\"name\": \"Follow aspect ratio?\", \"value\": [1]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}], \"color\": [{\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}, {\"name\": \"\", \"value\": [0, 0, 0]}], \"layer\": [{\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}, {\"name\": \"\", \"value\": [0]}]}"}]}